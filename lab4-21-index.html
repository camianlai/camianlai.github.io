<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文学书苑 - 探索文字之美</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/lab-21.css">
</head>
<body>
    <div class="container">
        <div class="loading-overlay"><div class="loading-spinner"></div></div>
        <div class="preview-modal"><div class="modal-content"><button class="close-modal">&times;</button></div></div>
        <div class="message-toast"><i class="fas fa-check-circle"></i><span class="toast-text">操作成功！</span></div>
        
        <!-- 悬浮购物车 -->
        <div class="floating-cart">
            <i class="fas fa-shopping-cart"></i>
            <span>购物车</span>
            <span class="cart-badge">0</span>
            <div class="cart-dropdown">
                <div class="cart-items" id="cartItems">
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <p>购物车是空的</p>
                    </div>
                </div>
                <div class="cart-total">
                    总计: ¥<span id="cartTotal">0.00</span>
                </div>
                <div class="cart-actions">
                    <button class="cart-action-btn clear-cart-btn" onclick="clearCart()">清空购物车</button>
                    <button class="cart-action-btn checkout-btn" onclick="checkout()">立即结算</button>
                </div>
            </div>
        </div>
        
        <header>
            <div class="header-content">
                <h1>文学书苑</h1>
                <div class="header-subtitle">探索文字之美，品味文学之韵</div>
                <div class="quote">"书籍是屹立在时间的汪洋大海中的灯塔。" — 惠普尔</div>
            </div>
        </header>
        
        <nav>
            <ul>
                <li><a href="#"><i class="fas fa-home"></i> 首页</a></li>
                <li><a href="#"><i class="fas fa-book"></i> 文学经典</a></li>
                <li><a href="#"><i class="fas fa-pen-fancy"></i> 现代文学</a></li>
                <li><a href="#"><i class="fas fa-globe-americas"></i> 世界文学</a></li>
                <li><a href="#"><i class="fas fa-user-edit"></i> 作家专栏</a></li>
                <li><a href="#"><i class="fas fa-envelope"></i> 联系我们</a></li>
            </ul>
        </nav>
        
        <div class="main-content">
            <div class="filter-section">
                <div class="filter-group">
                    <div class="filter-dropdown">
                        <button class="filter-btn"><i class="fas fa-book"></i> 文学分类</button>
                        <div class="filter-menu">
                            <label><input type="checkbox" name="category" value="classic"> 古典文学</label><br>
                            <label><input type="checkbox" name="category" value="modern"> 现代文学</label><br>
                            <label><input type="checkbox" name="category" value="romance"> 浪漫主义</label>
                        </div>
                    </div>
                    <div class="filter-dropdown">
                        <button class="filter-btn"><i class="fas fa-tag"></i> 价格区间</button>
                        <div class="filter-menu">
                            <label><input type="radio" name="price" value="0-50"> 0-50元</label><br>
                            <label><input type="radio" name="price" value="50-100"> 50-100元</label><br>
                            <label><input type="radio" name="price" value="100+"> 100元以上</label>
                        </div>
                    </div>
                    <div class="filter-dropdown">
                        <button class="filter-btn"><i class="fas fa-star"></i> 读者评分</button>
                        <div class="filter-menu">
                            <label><input type="radio" name="rating" value="4+"> 4星以上</label><br>
                            <label><input type="radio" name="rating" value="3+"> 3星以上</label><br>
                            <label><input type="radio" name="rating" value="all"> 全部评分</label>
                        </div>
                    </div>
                </div>
                <div class="active-filters" id="activeFilters">
                    <!-- 动态添加的活动筛选条件 -->
                </div>
            </div>
            
            <div class="highlight-box"><i class="fas fa-gift"></i> 本周推荐：经典文学作品限时特惠，满100减20！</div>
            
            <aside class="left-sidebar">
                <h2><i class="fas fa-list"></i> 文学分类</h2>
                <ul class="sidebar-list">
                    <li><a href="#">古典文学</a></li>
                    <li><a href="#">浪漫主义</a></li>
                    <li><a href="#">现代主义</a></li>
                    <li><a href="#">魔幻现实主义</a></li>
                    <li><a href="#">戏剧文学</a></li>
                    <li><a href="#">散文随笔</a></li>
                </ul>
                <div class="decorative-line"></div>
                <h2><i class="fas fa-fire"></i> 热门标签</h2>
                <div style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-top:1rem">
                    <span style="background:#e8e2d1;padding:0.3rem 0.7rem;border-radius:20px;font-size:0.8rem">经典名著</span>
                    <span style="background:#e8e2d1;padding:0.3rem 0.7rem;border-radius:20px;font-size:0.8rem">畅销小说</span>
                    <span style="background:#e8e2d1;padding:0.3rem 0.7rem;border-radius:20px;font-size:0.8rem">文学奖作品</span>
                    <span style="background:#e8e2d1;padding:0.3rem 0.7rem;border-radius:20px;font-size:0.8rem">作家签名版</span>
                </div>
            </aside>
            
            <main class="content">
                <section>
                    <h3 class="category-title">古典文学</h3>
                    <div class="book-container">
                        <div class="book-item" data-book-id="1" data-category="classic" data-price="45.80" data-rating="4.5">
                            <div class="book-image image-zoom-container">
                                <img src="/image/红楼梦.jpg">
                                <div class="zoom-lens"></div>
                                <div class="zoom-result"></div>
                            </div>
                            <div class="image-overlay"><span class="preview-text">点击预览</span></div>
                            <div class="book-info">
                                <div class="book-title">红楼梦</div>
                                <div class="book-author">作者：曹雪芹</div>
                                <div class="book-description">中国古典四大名著之首，一部具有世界影响力的人情小说，中国封建社会的百科全书。</div>
                                <div class="price-section">
                                    <div><span class="price">¥45.80</span><span class="original-price">¥58.00</span><span class="discount">7.9折</span></div>
                                </div>
                            </div>
                            <div class="book-actions">
                                <button class="action-btn add-cart-btn"><i class="fas fa-cart-plus"></i> 加入购物车</button>
                                <button class="action-btn buy-now-btn"><i class="fas fa-shopping-bag"></i> 立即购买</button>
                                <button class="action-btn view-detail-btn"><i class="fas fa-info-circle"></i> 查看详情</button>
                            </div>
                            <!-- 书籍详细信息弹出框 -->
                            <div class="book-detail-popup">
                                <h3 class="detail-title">红楼梦</h3>
                                <div class="detail-author">作者：曹雪芹</div>
                                <div class="detail-info">
                                    《红楼梦》，中国古代章回体长篇小说，中国古典四大名著之一，一般认为是清代作家曹雪芹所著。小说以贾、史、王、薛四大家族的兴衰为背景，以富贵公子贾宝玉为视角，以贾宝玉与林黛玉、薛宝钗的爱情婚姻悲剧为主线，描绘了一批举止见识出于须眉之上的闺阁佳人的人生百态，展现了真正的人性美和悲剧美，可以说是一部从各个角度展现女性美以及中国古代社会世态百相的史诗性著作。
                                </div>
                                <div class="detail-meta">
                                    <div class="meta-item"><i class="fas fa-book"></i> 页数：1200页</div>
                                    <div class="meta-item"><i class="fas fa-star"></i> 评分：9.5/10</div>
                                    <div class="meta-item"><i class="fas fa-calendar"></i> 出版时间：1791年</div>
                                    <div class="meta-item"><i class="fas fa-tag"></i> 分类：古典文学</div>
                                </div>
                                <div class="detail-actions">
                                    <button class="detail-action-btn" style="background:var(--primary-color);"><i class="fas fa-cart-plus"></i> 加入购物车</button>
                                    <button class="detail-action-btn" style="background:var(--accent-color);"><i class="fas fa-shopping-bag"></i> 立即购买</button>
                                </div>
                            </div>
                        </div>
                        <div class="book-item" data-book-id="2" data-category="classic" data-price="32.50" data-rating="4.2">
                            <div class="book-image image-zoom-container">
                                <img src="/image/诗经.jpg">
                                <div class="zoom-result"></div>
                            </div>
                            <div class="image-overlay"><span class="preview-text">点击预览</span></div>
                            <div class="book-info">
                                <div class="book-title">诗经</div>
                                <div class="book-author">作者：佚名（收集整理）</div>
                                <div class="book-description">中国第一部诗歌总集，收集了西周初年至春秋中叶的诗歌，共311篇。</div>
                                <div class="price-section">
                                    <div><span class="price">¥32.50</span><span class="original-price">¥40.00</span><span class="discount">8.1折</span></div>
                                </div>
                            </div>
                            <div class="book-actions">
                                <button class="action-btn add-cart-btn"><i class="fas fa-cart-plus"></i> 加入购物车</button>
                                <button class="action-btn buy-now-btn"><i class="fas fa-shopping-bag"></i> 立即购买</button>
                                <button class="action-btn view-detail-btn"><i class="fas fa-info-circle"></i> 查看详情</button>
                            </div>
                            <!-- 书籍详细信息弹出框 -->
                            <div class="book-detail-popup">
                                <h3 class="detail-title">诗经</h3>
                                <div class="detail-author">作者：佚名（收集整理）</div>
                                <div class="detail-info">
                                    《诗经》，是中国古代诗歌的开端，最早的一部诗歌总集，收集了西周初年至春秋中叶（前11世纪至前6世纪）的诗歌，共311篇，其中6篇为笙诗，即只有标题，没有内容，称为笙诗六篇（南陔、白华、华黍、由康、崇伍、由仪），反映了周初至周晚期约五百年间的社会面貌。
                                </div>
                                <div class="detail-meta">
                                    <div class="meta-item"><i class="fas fa-book"></i> 页数：480页</div>
                                    <div class="meta-item"><i class="fas fa-star"></i> 评分：9.2/10</div>
                                    <div class="meta-item"><i class="fas fa-calendar"></i> 成书时间：公元前6世纪</div>
                                    <div class="meta-item"><i class="fas fa-tag"></i> 分类：古典文学</div>
                                </div>
                                <div class="detail-actions">
                                    <button class="detail-action-btn" style="background:var(--primary-color);"><i class="fas fa-cart-plus"></i> 加入购物车</button>
                                    <button class="detail-action-btn" style="background:var(--accent-color);"><i class="fas fa-shopping-bag"></i> 立即购买</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section>
                    <h3 class="category-title">现代文学</h3>
                    <div class="book-container">
                        <div class="book-item" data-book-id="3" data-category="modern" data-price="28.60" data-rating="4.1">
                            <div class="book-image image-zoom-container">
                                <img src=/image/围城.jpg>
                                <div class="zoom-lens"></div>
                                <div class="zoom-result"></div>
                            </div>
                            <div class="image-overlay"><span class="preview-text">点击预览</span></div>
                            <div class="book-info">
                                <div class="book-title">围城</div>
                                <div class="book-author">作者：钱钟书</div>
                                <div class="book-description">中国现代文学史上一部风格独特的讽刺小说，被誉为"新儒林外史"。</div>
                                <div class="price-section">
                                    <div><span class="price">¥28.60</span><span class="original-price">¥35.00</span><span class="discount">8.2折</span></div>
                                </div>
                            </div>
                            <div class="book-actions">
                                <button class="action-btn add-cart-btn"><i class="fas fa-cart-plus"></i> 加入购物车</button>
                                <button class="action-btn buy-now-btn"><i class="fas fa-shopping-bag"></i> 立即购买</button>
                                <button class="action-btn view-detail-btn"><i class="fas fa-info-circle"></i> 查看详情</button>
                            </div>
                            <!-- 书籍详细信息弹出框 -->
                            <div class="book-detail-popup">
                                <h3 class="detail-title">围城</h3>
                                <div class="detail-author">作者：钱钟书</div>
                                <div class="detail-info">
                                    《围城》是钱钟书所著的长篇小说，是中国现代文学史上一部风格独特的讽刺小说。被誉为"新儒林外史"。第一版于1947年由上海晨光出版公司出版。故事主要写抗战初期知识分子的群相。
                                </div>
                                <div class="detail-meta">
                                    <div class="meta-item"><i class="fas fa-book"></i> 页数：392页</div>
                                    <div class="meta-item"><i class="fas fa-star"></i> 评分：9.1/10</div>
                                    <div class="meta-item"><i class="fas fa-calendar"></i> 出版时间：1947年</div>
                                    <div class="meta-item"><i class="fas fa-tag"></i> 分类：现代文学</div>
                                </div>
                                <div class="detail-actions">
                                    <button class="detail-action-btn" style="background:var(--primary-color);"><i class="fas fa-cart-plus"></i> 加入购物车</button>
                                    <button class="detail-action-btn" style="background:var(--accent-color);"><i class="fas fa-shopping-bag"></i> 立即购买</button>
                                </div>
                            </div>
                        </div>
                        <div class="book-item" data-book-id="4" data-category="modern" data-price="24.80" data-rating="4.0">
                            <div class="book-image image-zoom-container">
                                <img src=/image/边城.jpg>
                                <div class="zoom-lens"></div>
                                <div class="zoom-result"></div>
                            </div>
                            <div class="image-overlay"><span class="preview-text">点击预览</span></div>
                            <div class="book-info">
                                <div class="book-title">边城</div>
                                <div class="book-author">作者：沈从文</div>
                                <div class="book-description">以20世纪30年代川湘交界的边城小镇茶峒为背景，描绘了湘西地区特有的风土人情。</div>
                                <div class="price-section">
                                    <div><span class="price">¥24.80</span><span class="original-price">¥30.00</span><span class="discount">8.3折</span></div>
                                </div>
                            </div>
                            <div class="book-actions">
                                <button class="action-btn add-cart-btn"><i class="fas fa-cart-plus"></i> 加入购物车</button>
                                <button class="action-btn buy-now-btn"><i class="fas fa-shopping-bag"></i> 立即购买</button>
                                <button class="action-btn view-detail-btn"><i class="fas fa-info-circle"></i> 查看详情</button>
                            </div>
                            <!-- 书籍详细信息弹出框 -->
                            <div class="book-detail-popup">
                                <h3 class="detail-title">边城</h3>
                                <div class="detail-author">作者：沈从文</div>
                                <div class="detail-info">
                                    《边城》是沈从文的代表作，写于1933年至1934年初。这篇作品如沈从文的其他湘西作品，着眼于普通人、善良人的命运变迁，描摹了湘女翠翠阴差阳错的生活悲剧。
                                </div>
                                <div class="detail-meta">
                                    <div class="meta-item"><i class="fas fa-book"></i> 页数：256页</div>
                                    <div class="meta-item"><i class="fas fa-star"></i> 评分：9.0/10</div>
                                    <div class="meta-item"><i class="fas fa-calendar"></i> 出版时间：1934年</div>
                                    <div class="meta-item"><i class="fas fa-tag"></i> 分类：现代文学</div>
                                </div>
                                <div class="detail-actions">
                                    <button class="detail-action-btn" style="background:var(--primary-color);"><i class="fas fa-cart-plus"></i> 加入购物车</button>
                                    <button class="detail-action-btn" style="background:var(--accent-color);"><i class="fas fa-shopping-bag"></i> 立即购买</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
            
            <aside class="right-sidebar">
                <div class="decorative-line"></div>
                <h2><i class="fas fa-user-tie"></i> 文学大师</h2>
                <ul class="sidebar-list">
                    <li><a href="#">鲁迅</a></li>
                    <li><a href="#">老舍</a></li>
                    <li><a href="#">巴金</a></li>
                    <li><a href="#">茅盾</a></li>
                    <li><a href="#">沈从文</a></li>
                </ul>
                <div class="decorative-line"></div>
                <div style="background:linear-gradient(135deg,var(--accent-color),var(--accent-dark));color:var(--text-light);padding:1.2rem;margin:1.5rem 0;border-radius:var(--radius)">
                    <h3><i class="fas fa-crown"></i> 会员专享</h3>
                    <p style="margin-top:0.5rem;font-size:0.9rem">借阅图书免运费，参与线下活动优先报名！</p>
                </div>
                <div class="decorative-line"></div>
                <h2><i class="fas fa-newspaper"></i> 文学资讯</h2>
                <div style="margin-top:1rem">
                    <div style="padding:0.8rem 0;border-bottom:1px dashed var(--light-border)">
                        <div style="font-weight:600;font-size:0.9rem">2023年诺贝尔文学奖揭晓</div>
                        <div style="font-size:0.8rem;color:#666;margin-top:0.3rem">2天前</div>
                    </div>
                    <div style="padding:0.8rem 0;border-bottom:1px dashed var(--light-border)">
                        <div style="font-weight:600;font-size:0.9rem">全国文学创作大赛征稿启事</div>
                        <div style="font-size:0.8rem;color:#666;margin-top:0.3rem">5天前</div>
                    </div>
                    <div style="padding:0.8rem 0">
                        <div style="font-weight:600;font-size:0.9rem">著名作家新书分享会即将举行</div>
                        <div style="font-size:0.8rem;color:#666;margin-top:0.3rem">1周前</div>
                    </div>
                </div>
            </aside>
        </div>
        
        <footer>
            <p>文学书苑</p>
            <p>地址：北京市东城区文学路123号 | 电话：010-12345678</p>
            <p style="margin-top:1rem;font-size:0.9rem;opacity:0.8">© 2023 文学书苑 版权所有</p>
        </footer>
    </div>
    
    <script>
        // 购物车数据
        let cart = [];
        let cartCount = 0;
        let cartTotal = 0;
        
        // 筛选条件
        let activeFilters = {
            category: [],
            price: null,
            rating: null
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            showLoading();
            setTimeout(() => {
                hideLoading();
                showMessage('页面加载完成！');
            }, 1500);
            
            initBookInteractions();
            initFilterFunctionality();
            initPreviewModal();
            initCart();
            initDetailPopupActions();
            initImageZoom();
        });
        
        function showLoading() {
            document.querySelector('.loading-overlay').classList.add('show');
        }
        
        function hideLoading() {
            document.querySelector('.loading-overlay').classList.remove('show');
        }
        
        function showMessage(text) {
            const toast = document.querySelector('.message-toast');
            toast.querySelector('.toast-text').textContent = text;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // 初始化筛选功能
        function initFilterFunctionality() {
            // 分类筛选
            document.querySelectorAll('input[name="category"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        activeFilters.category.push(this.value);
                    } else {
                        activeFilters.category = activeFilters.category.filter(cat => cat !== this.value);
                    }
                    updateActiveFilters();
                    filterBooks();
                });
            });
            
            // 价格筛选
            document.querySelectorAll('input[name="price"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        activeFilters.price = this.value;
                    } else if (activeFilters.price === this.value) {
                        activeFilters.price = null;
                    }
                    updateActiveFilters();
                    filterBooks();
                });
            });
            
            // 评分筛选
            document.querySelectorAll('input[name="rating"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        activeFilters.rating = this.value;
                    } else if (activeFilters.rating === this.value) {
                        activeFilters.rating = null;
                    }
                    updateActiveFilters();
                    filterBooks();
                });
            });
        }
        
        // 更新活动筛选条件显示
        function updateActiveFilters() {
            const activeFiltersContainer = document.getElementById('activeFilters');
            activeFiltersContainer.innerHTML = '';
            
            // 分类筛选
            activeFilters.category.forEach(cat => {
                const filterElement = document.createElement('div');
                filterElement.className = 'active-filter';
                filterElement.innerHTML = `分类: ${getCategoryName(cat)} <span class="remove-filter" data-type="category" data-value="${cat}">×</span>`;
                activeFiltersContainer.appendChild(filterElement);
            });
            
            // 价格筛选
            if (activeFilters.price) {
                const filterElement = document.createElement('div');
                filterElement.className = 'active-filter';
                filterElement.innerHTML = `价格: ${getPriceRangeName(activeFilters.price)} <span class="remove-filter" data-type="price" data-value="${activeFilters.price}">×</span>`;
                activeFiltersContainer.appendChild(filterElement);
            }
            
            // 评分筛选
            if (activeFilters.rating) {
                const filterElement = document.createElement('div');
                filterElement.className = 'active-filter';
                filterElement.innerHTML = `评分: ${getRatingName(activeFilters.rating)} <span class="remove-filter" data-type="rating" data-value="${activeFilters.rating}">×</span>`;
                activeFiltersContainer.appendChild(filterElement);
            }
            
            // 添加移除筛选条件的事件
            document.querySelectorAll('.remove-filter').forEach(button => {
                button.addEventListener('click', function() {
                    const type = this.dataset.type;
                    const value = this.dataset.value;
                    
                    if (type === 'category') {
                        activeFilters.category = activeFilters.category.filter(cat => cat !== value);
                        document.querySelector(`input[name="category"][value="${value}"]`).checked = false;
                    } else if (type === 'price') {
                        activeFilters.price = null;
                        document.querySelector(`input[name="price"][value="${value}"]`).checked = false;
                    } else if (type === 'rating') {
                        activeFilters.rating = null;
                        document.querySelector(`input[name="rating"][value="${value}"]`).checked = false;
                    }
                    
                    updateActiveFilters();
                    filterBooks();
                });
            });
        }
        
        // 获取分类名称
        function getCategoryName(value) {
            const names = {
                'classic': '古典文学',
                'modern': '现代文学',
                'romance': '浪漫主义'
            };
            return names[value] || value;
        }
        
        // 获取价格范围名称
        function getPriceRangeName(value) {
            const names = {
                '0-50': '0-50元',
                '50-100': '50-100元',
                '100+': '100元以上'
            };
            return names[value] || value;
        }
        
        // 获取评分名称
        function getRatingName(value) {
            const names = {
                '4+': '4星以上',
                '3+': '3星以上',
                'all': '全部评分'
            };
            return names[value] || value;
        }
        
        // 筛选书籍
        function filterBooks() {
            const bookItems = document.querySelectorAll('.book-item');
            
            bookItems.forEach(item => {
                let show = true;
                
                // 分类筛选
                if (activeFilters.category.length > 0) {
                    const category = item.dataset.category;
                    if (!activeFilters.category.includes(category)) {
                        show = false;
                    }
                }
                
                // 价格筛选
                if (activeFilters.price) {
                    const price = parseFloat(item.dataset.price);
                    if (activeFilters.price === '0-50' && (price < 0 || price > 50)) {
                        show = false;
                    } else if (activeFilters.price === '50-100' && (price < 50 || price > 100)) {
                        show = false;
                    } else if (activeFilters.price === '100+' && price < 100) {
                        show = false;
                    }
                }
                
                // 评分筛选
                if (activeFilters.rating) {
                    const rating = parseFloat(item.dataset.rating);
                    if (activeFilters.rating === '4+' && rating < 4) {
                        show = false;
                    } else if (activeFilters.rating === '3+' && rating < 3) {
                        show = false;
                    }
                }
                
                // 显示或隐藏书籍
                if (show) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // 初始化图片放大功能
        function initImageZoom() {
            const zoomImages = document.querySelectorAll('.zoom-image');
            
            zoomImages.forEach(img => {
                const container = img.parentElement;
                const lens = container.querySelector('.zoom-lens');
                const result = container.querySelector('.zoom-result');
                
                // 计算放大比例
                const cx = result.offsetWidth / lens.offsetWidth;
                const cy = result.offsetHeight / lens.offsetHeight;
                
                // 设置放大图片
                result.style.backgroundImage = "url('" + img.src + "')";
                result.style.backgroundSize = (img.width * cx) + "px " + (img.height * cy) + "px";
                
                // 鼠标移动事件
                container.addEventListener('mousemove', function(e) {
                    e.preventDefault();
                    
                    // 获取鼠标位置
                    const pos = getCursorPos(e, img);
                    let x = pos.x - (lens.offsetWidth / 2);
                    let y = pos.y - (lens.offsetHeight / 2);
                    
                    // 防止镜头超出图片边界
                    if (x > img.width - lens.offsetWidth) x = img.width - lens.offsetWidth;
                    if (x < 0) x = 0;
                    if (y > img.height - lens.offsetHeight) y = img.height - lens.offsetHeight;
                    if (y < 0) y = 0;
                    
                    // 设置镜头位置
                    lens.style.left = x + "px";
                    lens.style.top = y + "px";
                    
                    // 设置放大区域
                    result.style.backgroundPosition = "-" + (x * cx) + "px -" + (y * cy) + "px";
                });
                
                // 鼠标进入事件
                container.addEventListener('mouseenter', function() {
                    lens.style.display = 'block';
                    result.style.display = 'block';
                });
                
                // 鼠标离开事件
                container.addEventListener('mouseleave', function() {
                    lens.style.display = 'none';
                    result.style.display = 'none';
                });
            });
        }
        
        // 获取鼠标在图片中的位置
        function getCursorPos(e, img) {
            const a = img.getBoundingClientRect();
            let x = e.pageX - a.left;
            let y = e.pageY - a.top;
            
            x = x - window.pageXOffset;
            y = y - window.pageYOffset;
            
            return {x: x, y: y};
        }
        
        function initCart() {
            // 为所有"加入购物车"按钮添加事件
            document.querySelectorAll('.add-cart-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    addToCart(this);
                });
            });
            
            // 加载本地存储的购物车数据
            loadCartFromStorage();
        }
        
        function addToCart(button) {
            const bookItem = button.closest('.book-item');
            const bookId = bookItem.dataset.bookId;
            const bookTitle = bookItem.querySelector('.book-title').textContent;
            const bookPrice = parseFloat(bookItem.querySelector('.price').textContent.replace('¥', ''));
            const bookImage = bookItem.querySelector('.book-image img').src;
            
            // 检查是否已在购物车
            const existingItem = cart.find(item => item.id === bookId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: bookId,
                    title: bookTitle,
                    price: bookPrice,
                    image: bookImage,
                    quantity: 1
                });
            }
            
            // 更新购物车
            updateCart();
            showMessage(`《${bookTitle}》已加入购物车`);
            
            // 添加点击动画
            button.style.transform = 'scale(0.9)';
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 200);
        }
        
        function removeFromCart(bookId) {
            cart = cart.filter(item => item.id !== bookId);
            updateCart();
            showMessage('商品已从购物车移除');
        }
        
        function updateQuantity(bookId, change) {
            const item = cart.find(item => item.id === bookId);
            if (item) {
                item.quantity += change;
                if (item.quantity < 1) item.quantity = 1;
                updateCart();
            }
        }
        
        function updateCart() {
            // 计算总数量和总价
            cartCount = cart.reduce((total, item) => total + item.quantity, 0);
            cartTotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            
            // 更新购物车徽章
            document.querySelectorAll('.cart-badge').forEach(badge => {
                badge.textContent = cartCount;
                if (cartCount > 0) {
                    badge.style.animation = 'none';
                    void badge.offsetWidth; // 触发重绘
                    badge.style.animation = 'bounce 0.5s';
                }
            });
            
            // 更新购物车下拉内容
            const cartItems = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <p>购物车是空的</p>
                    </div>
                `;
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <div class="cart-item-image"><img src="${item.image}" alt="${item.title}" style="width:100%;height:100%;object-fit:cover;"></div>
                        <div class="cart-item-info">
                            <div class="cart-item-title">${item.title}</div>
                            <div class="cart-item-price">¥${item.price.toFixed(2)}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                                <input type="text" class="quantity-input" value="${item.quantity}" readonly>
                                <button class="quantity-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                            </div>
                        </div>
                        <button class="remove-item" onclick="removeFromCart('${item.id}')">&times;</button>
                    </div>
                `).join('');
            }
            
            // 更新总价
            document.getElementById('cartTotal').textContent = cartTotal.toFixed(2);
            
            // 保存到本地存储
            saveCartToStorage();
        }
        
        function clearCart() {
            if (cart.length === 0) return;
            
            if (confirm('确定要清空购物车吗？')) {
                cart = [];
                updateCart();
                showMessage('购物车已清空');
            }
        }
        
        function checkout() {
            if (cart.length === 0) {
                showMessage('购物车是空的，请先添加商品');
                return;
            }
            
            showMessage(`开始结算，总计：¥${cartTotal.toFixed(2)}`);
            // 这里可以添加实际的结算逻辑
        }
        
        function saveCartToStorage() {
            localStorage.setItem('bookstore_cart', JSON.stringify(cart));
        }
        
        function loadCartFromStorage() {
            const savedCart = localStorage.getItem('bookstore_cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCart();
            }
        }
        
        function initBookInteractions() {
            const actionButtons = document.querySelectorAll('.action-btn');
            
            actionButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const bookItem = this.closest('.book-item');
                    const bookTitle = bookItem.querySelector('.book-title').textContent;
                    
                    if (this.classList.contains('buy-now-btn')) {
                        showMessage(`开始购买《${bookTitle}》`);
                    } else if (this.classList.contains('view-detail-btn')) {
                        showMessage(`查看《${bookTitle}》详情`);
                    }
                });
            });
            
            const bookImages = document.querySelectorAll('.book-image');
            bookImages.forEach(image => {
                image.addEventListener('click', function() {
                    const bookTitle = this.closest('.book-item').querySelector('.book-title').textContent;
                    const modal = document.querySelector('.preview-modal');
                    const modalContent = modal.querySelector('.modal-content');
                    
                    while(modalContent.children.length > 1) {
                        modalContent.removeChild(modalContent.lastChild);
                    }
                    
                    const previewContent = document.createElement('div');
                    previewContent.style.padding = '2rem';
                    previewContent.innerHTML = `<h2>${bookTitle}</h2><p style="margin-top:1rem;color:#666">本书预览内容即将呈现...</p><div style="margin-top:2rem;display:flex;gap:1rem"><button style="padding:0.8rem 1.5rem;background:var(--primary-color);color:white;border:none;border-radius:4px;cursor:pointer">加入购物车</button><button style="padding:0.8rem 1.5rem;background:var(--accent-color);color:white;border:none;border-radius:4px;cursor:pointer">立即购买</button></div>`;
                    modalContent.appendChild(previewContent);
                    modal.classList.add('show');
                    document.body.style.overflow = 'hidden';
                });
            });
            
            // 关闭模态框
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.querySelector('.preview-modal').classList.remove('show');
                document.body.style.overflow = 'auto';
            });
        }
        
        function initPreviewModal() {
            // 点击模态框外部关闭
            document.querySelector('.preview-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                    document.body.style.overflow = 'auto';
                }
            });
        }
        
        function initDetailPopupActions() {
            // 为详细信息弹出框中的按钮添加事件
            document.querySelectorAll('.detail-action-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const bookItem = this.closest('.book-item');
                    const bookTitle = bookItem.querySelector('.book-title').textContent;
                    
                    if (this.textContent.includes('加入购物车')) {
                        // 模拟加入购物车操作
                        const addCartBtn = bookItem.querySelector('.add-cart-btn');
                        addToCart(addCartBtn);
                    } else if (this.textContent.includes('立即购买')) {
                        showMessage(`开始购买《${bookTitle}》`);
                    }
                });
            });
        }
    </script>
</body>
</html>